\documentclass[12pt, letterpaper]{article}
\usepackage{graphicx} % needed for images
\usepackage[export]{adjustbox} % needed for adjustable images
\usepackage{flafter} % needed for figures
\usepackage[table, dvipsnames]{xcolor}
\usepackage{fancyhdr} % needed for fancy header 
\usepackage{listings}
\usepackage{pdflscape}
\usepackage{tabularx}
\usepackage{array}
\usepackage{texlogos}
\usepackage{color}
\usepackage{colortbl}
\usepackage{lineno}
\usepackage{hyperref}
\usepackage{dirtree}


\hypersetup{
    colorlinks=true,
    linkcolor=black,
    urlcolor=blue,
    pdfpagemode=FullScreen,
    }
\lstset{basicstyle=\ttfamily\footnotesize,breaklines=true}
\lstset{aboveskip=20pt,belowskip=20pt}

\lstdefinelanguage{Kotlin}{
  comment=[l]{//},
  commentstyle={\color{gray}\ttfamily},
  emph={filter, first, firstOrNull, forEach, lazy, map, mapNotNull, println},
  emphstyle={\color{OrangeRed}},
  identifierstyle=\color{black},
  keywords={!in, !is, abstract, actual, annotation, as, as?, break, by, catch, class, companion, const, constructor, continue, crossinline, data, delegate, do, dynamic, else, enum, expect, external, false, field, file, final, finally, for, fun, get, if, import, in, infix, init, inline, inner, interface, internal, is, lateinit, noinline, null, object, open, operator, out, override, package, param, private, property, protected, public, receiveris, reified, return, return@, sealed, set, setparam, super, suspend, tailrec, this, throw, true, try, typealias, typeof, val, var, vararg, when, where, while},
  keywordstyle={\color{NavyBlue}\bfseries},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  morestring=[s]{"""*}{*"""},
  ndkeywords={@Deprecated, @JvmField, @JvmName, @JvmOverloads, @JvmStatic, @JvmSynthetic, Array, Byte, Double, Float, Int, Integer, Iterable, Long, Runnable, Short, String, Any, Unit, Nothing},
  ndkeywordstyle={\color{BurntOrange}\bfseries},
  sensitive=true,
  stringstyle={\color{ForestGreen}\ttfamily},
}

\graphicspath{ {images/} }

\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{Aplicacions per a dispositius mòbils}
\fancyhead[RE,LO]{Resources en Android}
\fancyfoot[LE,RO]{\thepage}
\renewcommand{\headrulewidth}{1pt}
\renewcommand{\footrulewidth}{1pt}



% information
\title{%
    \begin{center}
	\includegraphics[width=4cm,height=3cm]{udl.png}
    \end{center}
    \line(1,0){250}\\[0.3cm]
    \textbf{Primera Activitat: Resources en Android} \\
    \line(1,0){250}
    \\[0.5cm]
	\large Aplicacions per a dispositius mòbils - Grau en Enginyería Informàtica
}
\author{Pablo Fraile Alonso}
\date{\today}

% document
\begin{document}
    
% title
\maketitle
\thispagestyle{empty}
\newpage
\tableofcontents
\listoffigures
\newpage

\section{Comprovar si s'aplica la primera bona pràctica}
Veiem l'estructura del projecte i en un principi si que compleix la primera bona pràctica, ja que té diferents recursos separats en diferents arxius, tal i com es veu en l'arbre d'arxius:

\vspace{0.5cm}
\dirtree{%
.1 FirstActivity.
.2 app.
.3 {...} .
.3 src.
.4 {...} .
.4 main.
.5 AndroidManifest.xml.
.5 java.
.5 res.
.6 drawable-{...}.
.6 layout.
.6 mipmap-{....}.
.6 values.
}
\vspace{0.5cm}

En cambi, si ens fixem al arxiu de layout, veiem que tot i que tingui creat l'arxiu \textit{strings.xml}, han "hardcodejat" la string "Hello World" dins de la component Textview:

\begin{lstlisting}[language=XML]
<TextView
    android:id="@+id/textView"
    ....
    android:text="Hello World"
    ...
/>
\end{lstlisting}

Quant realment, si es volgués separar els diferents recursos, s'hauria de cambiar el text a que referencii a les strings localitzades a: res/values/strings.xml.

\begin{lstlisting}[language=XML]
<TextView
    android:id="@+id/textView"
    ....
    android:text="@string/hello_world"
    ...
/>
\end{lstlisting}

\newpage
\section{Comprobar si se aplica la segunda buena práctica y añadir recursos alternativos para la app. }
La segona pràctica consisteix en "Provide alternative resources to support specific device configurations". Veiem que tot i que Android Studio ens hagi proporcionat diferents resources, aquests únicament venen adaptat
per un dispositiu móvil (no tablet), amb layout portrait (vertical) i idioma anglés, per tant es podría dir que no compleix la segona bona pràctica.\\

Després d'afegir compatibilitat amb diferents idiomes (català, castellà i anglés), modularitat de les diferents imatges i icona de l'app depenent de l'idioma del dispositiu i suportar diferents tamanys (tablet i móbil) i disposicions (horitzontal i vertical) l'estructura de la carpeta resources queda de la següent forma:

\vspace{0.5cm}
\dirtree{%
.0 res.
.1 drawable.
.2 image\_1.png.
.2 image\_2.png.
.2 image\_3.png.
.1 drawable-ca.
.2 image\_1.png.
.2 image\_2.png.
.2 image\_3.png.
.1 drawable-es.
.2 image\_1.png.
.2 image\_2.png.
.2 image\_3.png.
.1 layout.
.2 activity\_main.xml.
.1 layout-land.
.2 activity\_main.xml.
.1 layout-large.
.2 activity\_main.xml.
.1 layout-large-port.
.2 activity\_main.xml.
.1 mipmap-anydpi-v26.
.2 ic\_launcher\_round.xml.
.2 ic\_launcher.xml.
.1 mipmap-ca-hdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-ca-mdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-ca-xhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-ca-xxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-ca-xxxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-es-hdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-es-mdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-es-xhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-es-xxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-es-xxxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-hdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-mdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-xhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-xxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 mipmap-xxxhdpi.
.2 ic\_launcher\_foreground.png.
.2 ic\_launcher.png.
.2 ic\_launcher\_round.png.
.1 values.
.2 colors.xml.
.2 ic\_launcher\_background.xml.
.2 strings.xml.
.2 themes.xml.
.1 values-ca.
.2 ic\_launcher\_background.xml.
.2 strings.xml.
.1 values-es-rES.
.2 ic\_launcher\_background.xml.
.2 strings.xml.
.1 values-night.
.2 themes.xml.
}
\vspace{0.5cm}
A més, s'han hagut de modificar els diferents layouts, per a que totes les strings, imatges, etc. referenciin a les imatges i strings corresponents.

\begin{lstlisting}[language=XML]
    activity_main.xml:

    <TextView
        android:id="@+id/textView"
        ...
        android:text="@string/hello\_world"
        ...
    />

    <Button
        android:id="@+id/button"
        ...
        android:text="@string/buttonToast"
        ...
    />

    <ImageView
        android:id="@+id/image\_1"
        android:contentDescription="@string/image\_1\_description"
        app:srcCompat="@drawable/image\_1" 
        ...
    />

\end{lstlisting}

\newpage
\section{Añadir la funcionalidad de mostrar un mensaje emergente (Toast) en un botón del layout}
Se han provado varias opciones para añadir funcionalidad al botón, todas funcionan y son igual de válidas:

\subsection{Usando anonymous classes/lambdas}

\begin{lstlisting}[language=Kotlin]
    val button = findViewById<Button>(R.id.button)
    button.setOnClickListener (
        View.OnClickListener() {
            Toast.makeText(
                applicationContext,
                R.string.toastText,
                Toast.LENGTH_SHORT
            ).show()
        })
    }
\end{lstlisting}
Que en kotlin, con su estilo de lambda, podemos simplificar a:

\begin{lstlisting}[language=Kotlin]
    val button = findViewById<Button>(R.id.button)
    button.setOnClickListener {
        Toast.makeText(
            applicationContext,
            R.string.toastText,
            Toast.LENGTH_SHORT
        ).show()
    }
\end{lstlisting}

\subsection{Creando una inner class}

\begin{lstlisting}[language=Kotlin]
    private fun setUpButton() {
        val button = findViewById<Button>(R.id.button)
        button.setOnClickListener(Toaster())
    }

    private inner class Toaster : View.OnClickListener {
        override fun onClick(p0: View?) {
            Toast.makeText(
                applicationContext,
                R.string.toastText,
                Toast.LENGTH_LONG
            ).show()
        }
    }
\end{lstlisting}

\subsection{Creando una clase estática}
En caso de que la hiciesemos estática, tendriamos un poco más de problemas, ya que deberíamos passar la View por parámetro para poder obtener el contexto:
\begin{lstlisting}[language=Kotlin]
    fun setUpButton() {
        val button = findViewById<Button>(R.id.button)
        button.setOnClickListener (Toaster())
    }

    private class Toaster : View.OnClickListener {
        override fun onClick(p0: View?) {
            if (p0 != null) {
                Toast.makeText(
                    p0.context,
                    R.string.toastText,
                    Toast.LENGTH_SHORT
                ).show()
            }
        }
    }
\end{lstlisting}

\subsection{Añadir que función se debe de ejecutar en el xml del layout}
En el layout:
\begin{lstlisting}[language=XML]
    <Button
        android:id="@+id/button"
        android:text="@string/buttonToast"
        android:onClick="showToast"
        ....
    />
\end{lstlisting}

En el código de la activity:
\begin{lstlisting}[language=Kotlin]
    fun showToast(view: View) =
        Toast.makeText(
            applicationContext,
            R.string.toastText,
            Toast.LENGTH_SHORT
        ).show()
\end{lstlisting}

\newpage
\section{Imágenes del proyecto y repositorio remoto}

Como no se pueden poner todos los archivos xml del proyecto en un documento pdf, se ha decidido añadir el link al repositorio de git, por 
si el/la lector/a quiere consultar cualquier archivo. El repositorio se puede encontrar \href{https://github.com/Pablito2020/First-Activity}{aquí.}

\begin{figure}[!htbp]
    \includegraphics[scale = 0.12]{smartphone-vertical.jpg}
    \centering
    \caption{Aplicación en un móbil, con idioma inglés y layout portrait}
    \label{vertical}
\end{figure}

\begin{figure}[!htbp]
    \includegraphics[scale = 0.12]{smartphone-land.PNG}
    \centering
    \caption{Aplicación en un móbil, con idioma inglés y layout landscape}
    \label{vertical}
\end{figure}

\end{document}
